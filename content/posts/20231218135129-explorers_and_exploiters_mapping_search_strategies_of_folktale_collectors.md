+++
title = "Coverage-based Comparisons of Cultural Diversity"
author = ["Folgert Karsdorp"]
lastmod = 2024-01-17T11:23:27+01:00
tags = ["diversity", "chao2", "incidence", "folktales", "bias"]
draft = false
+++

This notebook is the first of a series of notebooks based on a talk I gave at
the CUDAN 2023 conference in Tallinn, Estonia (<https://cudan.tlu.ee/conference/>)
together with [Melvin Wevers](https://www.melvinwevers.nl) and [Mike Kestemont](http://mikekestemont.github.io/), titled _Steady Formulas,
Shifting Spells: Estimating Folktale Diversity_.


## Comparing Cultural Diversity Estimates {#comparing-cultural-diversity-estimates}

Quantifying the diversity of cultural collections presents many unique
challenges. In earlier posts (e.g., [Demystifying Chao1 with Good-Turing]({{< relref "20220309103709-good_turing_as_an_unseen_species_model.md" >}}) and
[Population Size Estimation as a Regression Problem]({{< relref "20220405110456-population_size_regression_estimators.md" >}})), I've discussed the issue of
undersampling in cultural collections, largely as a consequence of cultural
loss. In this post, I discuss some problems when _comparing_ diversity
measurements: When and how can we assert that one collection is more diverse
than another?

The collection I study in this notebook is a unique assemblage of Dutch
folktales, gathered by the Meertens Institute in the 1960s and 70s. Embarking on
an ambitious project to create a comprehensive Dutch folktale atlas, the
institute recruited a group of dedicated folktale collectors. These collectors
were tasked with visiting storytellers within specific areas around their homes,
ultimately with the aim of covering the entire map of the Netherlands. This
groundbreaking endeavor in folklore research led to the collection of over
32,000 stories. However, as indicated by the map below, many regions of the
Netherlands remained uncharted in this collection, highlighting gaps and the
diverse interests of the collectors in shaping its completeness and reliability.

{{< figure src="/ox-hugo/2023-12-18_14-07-08_dekker-kaart.jpg" caption="<span class=\"figure-number\">Figure 1: </span>Map by A.J. Dekker showing the residences of the narrators visited by the collectors of the Folklore Bureau between 1962 and 1977." >}}

Cultural diversity manifests in various forms, and one of the simplest methods
to gauge the diversity in collections such as these folktales is by counting the
unique items or unique categories within them. Referred to as the '[richness]({{< relref "20220211122147-richness.md" >}})' of
the collection, this metric offers a quick snapshot of their diversity. However,
this simplicity comes with a downside. The richness measurement is notably
sensitive; even minor changes in the collection can significantly impact the
result. Furthermore, there is a strong correlation between the perceived
richness and the size of the sample (<a href="#citeproc_bib_item_3">Chao and Jost 2012</a>).
And this correlation can greatly impede comparisons across different
collections.

This correlation is clearly present in the collection of folktales, where the
sampling effort of the collectors varies greatly. Take the folktale collector
Dam Jaarsma, for example. He compiled a collection with over 15 thousand
stories. These stories can be classified into more than 600 unique folktale
types (such as the ones by <a href="#citeproc_bib_item_6">Uther 2004</a>). By
contrast, a collection of someone like Kooijman consists of a little over 2
thousand stories, which can be grouped into a little over 100 different types.
Strictly speaking, the collection of Jaarsma is more diverse than that of
Kooijman, yet intuitively it feels unfair to state that the area where these
stories were sampled from are more or less diverse, as it so strongly depends on
the collectors' search efforts. This strong correlation between sample size and
richness is further illustrated in the following plot:

{{< figure src="/ox-hugo/2024-01-12_12-00-58_sample-size.png" caption="<span class=\"figure-number\">Figure 2: </span>Relation between the sample size (measure in number of stories) and unique story types." >}}


## Rarifying Species {#rarifying-species}

Ecologists face a similar problem when measuring biological diversity. To adjust
for the impact of sample size, ecologists have developed a method called
rarefaction. This technique involves downsizing larger collections to match the
size of the smallest sample. The essence of rarefaction lies in its ability to
compute the richness of species for a specific count of individual samples. This
is done through the construction of what are known as rarefaction curves. These
curves graph the relationship between the number of species identified and the
number of samples collected. They can be considered the statistical expection of
the corresponding collector's curve (also called 'accumulation curve' or
'species discovery curve'), which records the _empirical_ number of species
reveiled as we progress to sample more individuals. Consider the plot below,
depicting both an accumulation curve and its corresponding rarefaction curve:

{{< figure src="/ox-hugo/2024-01-15_09-15-39_rarefaction.png" caption="<span class=\"figure-number\">Figure 3: </span>Fictional collector's curve and its corresponding rarefaction curve." >}}

Typically, these rarefaction curves rise quickly initially, capturing the most
common species, and then level off as it becomes increasingly challenging to
find new, rare species. The fundamental concept is that the more individuals you
sample from a community, the more species you're likely to encounter. To
construct a rarefaction curve, ecologists repeatedly and randomly select subsets
of size \\(m\\) from the total pool of \\(N\\) samples. They then plot the average
species count found in each subset, ranging from 1 to \\(N\\). In essence,
rarefaction predicts the expected species count in a smaller group of \\(m\\)
individuals (or \\(m\\) samples), randomly selected from the larger set of \\(N\\)
samples.


## Rarifying Folktales {#rarifying-folktales}

With this tool in hand, we can compare the richnesses folktale collections with
different sample sizes, by standardizing the collections to the sample size of
the smallest collection. For example, let's compare the collections of Jaarsma
and Keuning, who sampled 15,326 and 837 folktales respectively. We thus
standardize the larger collection of Jaarsma to 837 stories and compute the
rarefaction curve:

{{< figure src="/ox-hugo/2024-01-15_14-00-21_rarefaction_Keuning_Jaarsma.png" caption="<span class=\"figure-number\">Figure 4: </span>Comparison of Rarefaction curves of the collectors Jaarsma and Keuning." >}}

This curve reveals the richness ratios between the two collections at various
sample sizes. Starting from a ratio of 1.57 at a sample size of \\(n=100\\) and
increasing to 2.34 at the complete collection of Keuning (\\(n=837\\)), it becomes
evident that the apparent difference in richness is more a function of the
chosen sample size rather than an intrinsic characteristic of the collections
themselves. With higher degrees of rarification the _underestimation_ of the
degree of difference between the collections thus goes up.


## Replication or Doubling Property {#replication-or-doubling-property}

This phenomenon arises because estimating richness from samples of a fixed size
fails to adhere to what is known as the 'doubling property'
(<a href="#citeproc_bib_item_5">Hill 1973</a>) or 'replication principle'
(<a href="#citeproc_bib_item_3">Chao and Jost 2012</a>). According to this principle, when two
subsamples of equal size, each containing entirely distinct species but sharing
the same abundance distribution, are combined, an desirable measure of diversity
should reflect a doubling effect. The doubling principle is also what we
intuitively expect from a diversity measure. If, for example, we study the
richness of the combined sample, we would expect it to be twice as diverse
(see <a href="#citeproc_bib_item_5">Hill 1973</a> for a family of diversity measures
that retain the doubling property even for higher order diversity values).

However, when estimating richness based on fixed sample sizes, as demonstrated
in our rarefaction curves, the doubling property is _not_ observed. To
illustrate this, let's consider an example from
(<a href="#citeproc_bib_item_3">Chao and Jost 2012</a>), who examine two communities, \\(A\\) and
\\(B\\). Each community has the same abundance distribution but no shared species:

```python
A = np.arange(50)
pA = np.array([0.3] + [0.1] + [0.05] * 3 + [0.01] * 45)

B = np.arange(50, 100)
pB = pA.copy()
```

Suppose we sample 20 individuals (with replacement) from community \\(A\\). On
average, this sample is expected to contain about 12 species:

```python
n_iter = 1000
n_species = np.zeros(n_iter)

for i in range(n_iter):
    sample = np.random.choice(A, size=20, p=pA)
    n_species[i] = len(set(sample))
print(n_species.mean())
```

```text
12.045
```

Now, consider a pooled sample from \\(A+B\\) and sample 20 individuals again. The
expected number of species is not 24 (double of 12), but approximately 14:

```python
n_iter = 1000
n_species = np.zeros(n_iter)

AB = np.hstack((A, B))
pAB = np.hstack((pA, pB))
pAB = pAB / pAB.sum()

for i in range(n_iter):
    sample = np.random.choice(AB, size=20, p=pAB)
    n_species[i] = len(set(sample))
print(n_species.mean())
```

```text
14.274
```

These results indicate a significant underestimation of diversity. In this case,
the richness difference ratio is approximately 1.18, far from the true value
of 2. The rarefaction curve below highlights this discrepancy in further detail.
It shows the instability of the richness ratio as a function of sample size and
the absence of the doubling property, even at higher sample sizes.

{{< figure src="/ox-hugo/2024-01-16_10-01-16_rarefaction_A_B.png" caption="<span class=\"figure-number\">Figure 5: </span>Rarefaction curve illustrating the absence of the doubling property when estimating richnesses based on samples of fixed size (based on <a href=\"#citeproc_bib_item_3\">Chao and Jost 2012</a>)" >}}


## Standardizing by Sample Coverage {#standardizing-by-sample-coverage}

As initially proposed by Alroy (<a href="#citeproc_bib_item_1">2010</a>)
and further developed by Chao and Jost (<a href="#citeproc_bib_item_3">2012</a>), the key to
addressing this issue lies in comparing samples based on equal completeness, or
more precisely, equal coverage, rather than equal equal sample size. The term
'coverage' traces its roots back to the cryptographic work of Alan Turing during
World War II. As Good highlighted in
(<a href="#citeproc_bib_item_4">1953</a>), coverage is defined as the
proportion of individuals in a community that are represented in a sample,
belonging to the identified species. In simpler terms, it indicates the
likelihood that a newly sampled individual will belong to a species already
present in the sample.

Conversely, the term 'coverage deficit', as termed by Chao and colleagues in
their (<a href="#citeproc_bib_item_3">2012</a>) paper, is calculated by
subtracting the sample’s coverage from one. This deficit represents the portion
of the community composed of species not yet included in the sample. Notably,
the coverage deficit is a critical component in calculating the Unseen Species
Estimator, known as Chao1 (<a href="#citeproc_bib_item_2">Chao 1984</a>). For a
more detailed explanation, refer to my notebook '[Demystifying Chao1 with
Good-Turing]({{< relref "20220309103709-good_turing_as_an_unseen_species_model.md" >}})'. The formula to estimate sample coverage is straightforward:

\begin{equation}
\hat{C}\_n = 1 - \frac{f\_1}{n},
\end{equation}

where \\(f\_1\\) is the count of species or categories that appear only once in the
sample. An enhanced version of this estimator was proposed by Chao and Shen in
2010:

\begin{equation}
\hat{C}\_n = 1 - \frac{f\_1}{n} \left [ \frac{(n - 1) f\_1}{(n - 1) f\_1 + 2 f\_2} \right ]
\end{equation}

As we will see, the key insight here is that when samples are standardized by
coverage, the doubling property is approximately satisfied. And therefore, richness
estimates of any two communities, when adjusted for coverage, provide a more
accurate reflection of their actual diversity relationship, compared to
traditional richness estimates based on fixed sample sizes. In the following
plot, I compare the two communities \\(A\\) and \\(A+B\\) based on shared coverage
values. The richness ratio satisfies the doubling principle, even for relatively
small sample sizes and low coverage.

{{< figure src="/ox-hugo/2024-01-16_12-40-41_rarefaction_A_B_coverage.png" caption="<span class=\"figure-number\">Figure 6: </span>Illustration of Standardizing Rarefaction Curves by Coverage" >}}


## Comparing Folktale Diversity by Coverage {#comparing-folktale-diversity-by-coverage}

This opens up quite exciting possibilities, as it would allow us to make
meaningful judgements about about which community of cultural collection is more
diverse than the other. This goes beyond simple rankings in terms of diversity.
We're now equipped to quantify the actual magnitude of these differences in
diversity, as detailed by (/t <a href="#citeproc_bib_item_3">Chao and Jost 2012</a>). In the
concluding part of this post, I will demonstrate the application of
coverage-based rarefaction curves to the folktale collection compiled by the
Meertens Institute.

We'll start by comparing the collections of two folklorists, Jaarsma and
Bijlsma, both of whom collected folktales in the Frysia province. The plot that
follows illustrates the size-based rarefaction extrapolation curves for their
respective collections.

{{< figure src="/ox-hugo/2024-01-17_08-35-33_rarefaction_Bijlsma_Jaarsma_size.png" caption="<span class=\"figure-number\">Figure 7: </span>Size-based rarefaction-extrapolation curve for Jaarsma and Bijlsma." >}}

In the displayed plots, the solid lines depict the rarefaction, and the dashed
lines represent the extrapolation process. Notably, in these visualizations, the
richness ratio remains approximately at 1.8. Now, let's contrast this with the
coverage-based rarefaction-extrapolation shown in the subsequent plot. While the
size-based approach estimates the richness difference to be less than 2, the
coverage-based analysis paints a different picture. It indicates a significantly
larger disparity, with the richness ratio estimated to be around 3.6

{{< figure src="/ox-hugo/2024-01-17_08-38-59_rarefaction_Bijlsma_Jaarsma_coverage.png" caption="<span class=\"figure-number\">Figure 8: </span>Coverage-based rarefaction-extrapolation curve for Jaarsma and Bijlsma." >}}

The disparity in richness between the collections of Jaarsma and Bijlsma is
notably significant. When examining other pairs of collectors, the differences
in richness are generally smaller. However, it's consistently observed that the
coverage-based richness estimates are higher compared to those derived from
size-based methods. For instance, consider the comparison between the
collections of Wever, who focused on gathering stories in the northeastern part
of the Netherlands, and Kooijman, whose collection mainly comes from the
South-Holland province.

{{< figure src="/ox-hugo/2024-01-17_11-08-28_rarefaction_Kooijman_Wever_size.png" caption="<span class=\"figure-number\">Figure 9: </span>Size-based rarefaction-extrapolation curve for Kooijman and Wever." >}}

The coverage-based rarefaction-extrapolation curves are as follows:

{{< figure src="/ox-hugo/2024-01-17_11-08-53_rarefaction_Kooijman_Wever_coverage.png" caption="<span class=\"figure-number\">Figure 10: </span>Coverage-based rarefaction-extrapolation curve for Kooijman and Wever." >}}

When comparing these size-based and coverage-based numbers,
Chao and Jost (<a href="#citeproc_bib_item_3">2012</a>) emphasize a key distinction in their
approach: while size-based standardization depends on the samplers' discretion,
coverage-based standardization allows for comparisons of equivalent population
fractions from each community. This fraction represents a characteristic at the
community level, one that can be reliably estimated from the available data.


## Outlook {#outlook}

This notebook has delved into the complexities of measuring cultural diversity,
with a special focus on a distinctive collection of Dutch folktales. In upcoming
posts, I plan to delve deeper into the various factors that influence coverage
and diversity within such collections. A key aspect of this exploration will be
examining the roles and sampling strategies of the collectors themselves.

## References

<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Alroy, John. 2010. “Geographical, Environmental and Intrinsic Biotic Controls on Phanerozoic Marine Diversification: Controls on Phanerozoic Marine Diversification.” <i>Palaeontology</i> 53 (6): 1211–35. <a href="https://doi.org/10.1111/j.1475-4983.2010.01011.x">https://doi.org/10.1111/j.1475-4983.2010.01011.x</a>.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>Chao, Anne. 1984. “Nonparametric Estimation of the Number of Classes in a Population.” <i>Scandinavian Journal of Statistics</i> 11 (4): 265–70. <a href="https://www.jstor.org/stable/4615964">https://www.jstor.org/stable/4615964</a>.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_3"></a>Chao, Anne, and Lou Jost. 2012. “Coverage-Based Rarefaction and Extrapolation: Standardizing Samples by Completeness Rather than Size.” <i>Ecology</i> 93 (12): 2533–47. <a href="https://doi.org/10.1890/11-1952.1">https://doi.org/10.1890/11-1952.1</a>.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_4"></a>Good, I. J. 1953. “The Population Frequencies of Species and the Estimation of Population Parameters.” <i>Biometrika</i> 40 (3-4): 237–64. <a href="https://doi.org/10.1093/biomet/40.3-4.237">https://doi.org/10.1093/biomet/40.3-4.237</a>.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_5"></a>Hill, M. O. 1973. “Diversity and Evenness: A Unifying Notation and Its Consequences.” <i>Ecology</i> 54 (2): 427–32. <a href="https://doi.org/10.2307/1934352">https://doi.org/10.2307/1934352</a>.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_6"></a>Uther, Hans-Jörg. 2004. <i>The Types of International Folktales: A Classification and Bibliography, Based on the System of Antti Aarne and Stith Thompson</i>. 284-286. Suomalainen Tiedeakatemia, Academia Scientiarum Fennica.</div>
</div>
